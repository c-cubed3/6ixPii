<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #map {
            width: 100%;
            height: 400px;
            background-color: grey;
        }
    </style>
</head>
<body>
        <!-- <h3>My Google Maps Demo</h3>
        <div id="map"></div> -->
        <button>stalk meh</button>

        <!-- <script>

            function initMap() {

                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 5,
                    center: { lat: -28.024, lng: 140.887 }
                });

                // Create an array of alphabetical characters used to label the markers.
                var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

                // Add some markers to the map.
                // Note: The code uses the JavaScript Array.prototype.map() method to
                // create an array of markers based on a given "locations" array.
                // The map() method here has nothing to do with the Google Maps API.
                var markers = locations.map(function (location, i) {
                    return new google.maps.Marker({
                        position: location,
                        label: labels[i % labels.length]
                    });
                });

                // Add a marker clusterer to manage the markers.
                var markerCluster = new MarkerClusterer(map, markers,
                    { imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m' });
            }
            var locations = [
                    { lat: -31.563910, lng: 147.154312 },
                    { lat: -33.718234, lng: 150.363181 },
                    { lat: -33.727111, lng: 150.371124 },
                    { lat: -33.848588, lng: 151.209834 },
                    { lat: -33.851702, lng: 151.216968 },
                    { lat: -34.671264, lng: 150.863657 },
                    { lat: -35.304724, lng: 148.662905 },
                    { lat: -36.817685, lng: 175.699196 },
                    { lat: -36.828611, lng: 175.790222 },
                    { lat: -37.750000, lng: 145.116667 },
                    { lat: -37.759859, lng: 145.128708 },
                    { lat: -37.765015, lng: 145.133858 },
                    { lat: -37.770104, lng: 145.143299 },
                    { lat: -37.773700, lng: 145.145187 },
                    { lat: -37.774785, lng: 145.137978 },
                    { lat: -37.819616, lng: 144.968119 },
                    { lat: -38.330766, lng: 144.695692 },
                    { lat: -39.927193, lng: 175.053218 },
                    { lat: -41.330162, lng: 174.865694 },
                    { lat: -42.734358, lng: 147.439506 },
                    { lat: -42.734358, lng: 147.501315 },
                    { lat: -42.735258, lng: 147.438000 },
                    { lat: -43.999792, lng: 170.463352 }
                ]
            </script>
            <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
            </script>
            <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc&callback=initMap">
            </script> -->

        <!-- <script>
            function initMap() {
                var toronto = { lat: 43.6532, lng: -79.3832};

                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 4,
                    center: toronto
                });
                var marker = new google.maps.Marker({
                    position: toronto,
                    map: map
                });
            }
        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc&callback=initMap"></script> -->

    
    <!-- <script src='https://code.jquery.com/jquery-3.2.1.min.js' integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4='crossorigin='anonymous'></script> -->
    <!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc&libraries=places"></script> -->

    <!-- <script>
        $.ajax({
            url: 'https://www.refugerestrooms.org:443/api/v1/restrooms/by_location.json',
            method: 'GET',
            dataType: 'json',
            data: {
                per_page: 30,
                lat: 43.6532,
                lng: -79.3832
            }
        }).then((res)=> {
            console.log(res);
        });

        // THIS IS FOR NEARBY SEARCH
        $.ajax({
            url: 'https://proxy.hackeryou.com',
            method: 'GET',
            dataType: 'json',
            data: {
                reqUrl: 'https://maps.googleapis.com/maps/api/place/nearbysearch/json',
               params: {
                    // method: 'GET',
                    // dataType: 'json',
                    key: 'AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc',
                    location: '43.654438, -79.380699',
                    radius: 30
               }
            }
        }).then((res2)=>{
            console.log(res2);
        // });


        // FOR GEO CODE GOOGLE API RETRIEVES PLACE ID
        // $.ajax({
        //     url: 'https://proxy.hackeryou.com',
        //     method: 'GET',
        //     dataType: 'json',
        //     data: {
        //         reqUrl: 'https://maps.googleapis.com/maps/api/geocode/json',
        //         params: {
        //             // method: 'GET',
        //             // dataType: 'json',
        //             key: 'AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc',
        //             // q: 'toronto'
        //             address: '64+smithwood+drive,+ca' 
        //         }
        //     }
        // }).then((res3)=>{
        //     console.log(res3);
        });
    </script> -->

    <!-- <script>
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        var map, infoWindow;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -34.397, lng: 150.644 },
                zoom: 6
            });
            infoWindow = new google.maps.InfoWindow;

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('found ya, think you could run');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
                } else {
                            // Browser doesn't support Geolocation
                            handleLocationError(false, infoWindow, map.getCenter());
                        }
                    }

                    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                        infoWindow.setPosition(pos);
                        infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
                        infoWindow.open(map);
                    }
                </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc&callback=initMap">
    </script> -->

    <!-- someting working -->
    <script src='https://code.jquery.com/jquery-3.2.1.min.js' integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4='crossorigin='anonymous'></script>
    <script>
        // function initMap() {
        //         // var uluru = { lat: -25.363, lng: 131.044 };
        //         var map = new google.maps.Map(document.getElementById('map'), {
        //             zoom: 4,
        //             center: locations[0]
        //         });
        //         var marker = new google.maps.Marker({
        //             position: locations[0],
        //             map: map
        //         });
        //     }


        const pos = {};
        let locations = [];

        // array with types to be passed in arguments
        pos.venues = ['cafe', 'restaurant', `shopping_mall`];

        // get user permission to track location
        const getLocation = function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    pos.lat = position.coords.latitude;
                    pos.lng = position.coords.longitude;
                    // pass in pos.getVenues to access user location
                    pos.getVenues();
                    //
                });
            }
        }
        
        //  essentially a function to have all the params in the pos.venues array passed one by one to the ajax requesst and use $.when() to retrieve into and pass it all into onne array
        pos.getVenues = () => {
            // const venues2 = pos.venues.map()
            // for (i = 0; i < pos.venues.length; i++) {
            //     // console.log(pos.venues[i]);
            //     $.when(getVenue(pos.venues[i])).then((res) => {
            //         console.log(res.results);
            //     });
            // }
            // console.log('hi');

            pos.venues.forEach((item)=>{
                getVenue(item).then((res)=>{res.results.forEach((jtem)=>{
                        locations.push(jtem.geometry.location);
                    });
                }); 
            });
            console.log(locations);
            // PSUEDOCODE RYANN PROVIDED
            //Using the venues array we will make a request for each of them and thenn
            // use the .when methos listen for when they are all done
            //Using the map method, figure out how to return a new array of calles to the places api.
        }
        
        // ajax req
        const getVenue = function (venueType) {
            return $.ajax({
                url: 'https://proxy.hackeryou.com',
                method: 'GET',
                dataType: 'json',
                data: {
                    reqUrl: 'https://maps.googleapis.com/maps/api/place/nearbysearch/json',
                    params: {
                        key: 'AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc',
                        location: `${pos.lat},${pos.lng}`,
                        radius: 1000,
                        type: venueType
                    },
                },
            })
        }

        // just a button for user to click to give permission 
        $(function () {
            $('button').on('click', function () {
                getLocation();
                // initMap();
            });
        });
    </script>
    <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc&callback=initMap"> -->
    <!-- </script> -->
</body>
</html>