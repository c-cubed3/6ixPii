<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h3>My Google Maps Demo</h3>
    <div id="map"></div>
    <button>stalk meh</button>
    <script src='https://code.jquery.com/jquery-3.2.1.min.js' integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4='crossorigin='anonymous'></script>
    <script>
        const pos = {};
        let locations = [];

        function initMap() {
            // var uluru = { lat: -25.363, lng: 131.044 };
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 4,
                center: locations[0]
            });
            var marker = new google.maps.Marker({
                position: locations[0],
                map: map
            });
        }

        // array with types to be passed in arguments
        pos.venues = ['cafe', 'restaurant', `shopping_mall`, 'gas_station'];

        // get user permission to track location
        const getLocation = function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    pos.lat = position.coords.latitude;
                    pos.lng = position.coords.longitude;
                    // pass in pos.getVenues to access user location
                    pos.getVenues();
                    initMap();
                });
            }
        }
        
        //  essentially a function to have all the params in the pos.venues array passed one by one to the ajax requesst and use $.when() to retrieve into and pass it all into onne array
        pos.getVenues = () => {

            // for each in a for each to recieive location objects
            pos.venues.forEach((item)=>{
                getVenue(item).then((res)=>{res.results.forEach((jtem)=>{
                        // pushing the lat-long objects into an array
                        locations.push(jtem.geometry.location);
                        
                    });
                });Â 
            });
            console.log(locations);
            // PSUEDOCODE RYANN PROVIDED
            //Using the venues array we will make a request for each of them and thenn
            // use the .when methos listen for when they are all done
            //Using the map method, figure out how to return a new array of calles to the places api.
        }
        
        // ajax req
        const getVenue = function (venueType) {
            return $.ajax({
                url: 'https://proxy.hackeryou.com',
                method: 'GET',
                dataType: 'json',
                data: {
                    reqUrl: 'https://maps.googleapis.com/maps/api/place/nearbysearch/json',
                    params: {
                        key: 'AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc',
                        location: `${pos.lat},${pos.lng}`,
                        radius: 500,
                        type: venueType
                    },
                },
            })
        }

        // just a button for user to click to give permission 
        $(function () {
            $('button').on('click', function () {
                getLocation();
            });
        });
    </script>    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANaLsqMb-Vp4_WS06TGn6F2Whc_XB8Lbc&callback=getLocation">
    </script>
</body>
</html>